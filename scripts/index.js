!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);const s=Object({CREATED:0,EXECUTING:1,PAUSED:2,STOPPED:3});let n=new Array;class r extends EventTarget{constructor(e,t){super(),null!=e&&""!=e||(e=Date.now().toString()),-1!=n.indexOf(e)&&(e+=Date.now().toString()),n.push(e),this._screen=document.createElement("div"),this._screen.style.position="absolute",this._screen.style.opacity=0,this._screen.style.boxSizing="border-box",this._state=s.CREATED,this._id=e,t.appendChild(this._screen)}stop(){this.state=s.STOPPED,this.dispatchEvent(new CustomEvent("OnStop"))}start(){this.state=s.EXECUTING,this.dispatchEvent(new CustomEvent("OnStart"))}pause(){this.state=s.PAUSED,this.dispatchEvent(new CustomEvent("OnPause"))}reset(){this.state=s.CREATED,this.dispatchEvent(new CustomEvent("OnReset"))}get state(){return this._state}get id(){return this._id}onKeyboardEvent(e){}set state(e){this._screen.style.opacity=1!=e?0:1,this.dispatchEvent(new CustomEvent("StateChanging",{detail:{oldState:this._state,newState:e}})),this._state=e}}class h extends EventTarget{constructor(){super(),this._body=new Array}get body(){return Array.from(this._body)}draw(){}}class a extends h{constructor(e){super(),this.lastPlace={x:0,y:0},this.millisecondsPerStep=200,this.alive=!0,this.gameField=e;let t={x:0,y:0,div:document.createElement("div")};for(let i=0;i<3;i++)if(e.isFreeCell(t))e.take小ell(t),this._body.push(t);else if(e.isFreeCell({x:t.x+1,y:t.y}))t={x:t.x+1,y:t.y,div:document.createElement("div")},e.take小ell(t),this._body.push(t);else{if(!e.isFreeCell({x:t.x,y:t.y+1})){if(t.x+1<e.maxX)t={x:t.x+1,y:t.y,div:document.createElement("div")};else if(t.y+1<e.maxY)t={x:t.x,y:t+y,div:document.createElement("div")};else if(0!=this._body.length)break;i-=1;continue}t={x:t.x,y:t.y+1,div:document.createElement("div")},e.take小ell(t),this._body.push(t)}this.direction={x:0,y:1}}get head(){return this._body[0]}kill(){this.alive&&(this.stop(),this.dispatchEvent(new Event("Death")),this.alive=!1)}move(){this.intervalId=setInterval(this.makeStep.bind(this),this.millisecondsPerStep)}stop(){clearInterval(this.intervalId)}addSegment(){this._body.push({x:this.lastPlace.x,y:this.lastPlace.y,div:document.createElement("div")}),this.dispatchEvent(new CustomEvent("GrowUp",{detail:this._body}))}makeStep(){this.dispatchEvent(new CustomEvent("PrevStep",{detail:this._body})),this.lastPlace.x=this._body[this._body.length-1].x,this.lastPlace.y=this._body[this._body.length-1].y;for(let e=this._body.length-1;e>0;e--){let t=this._body[e],i=this._body[e-1];t.x=i.x,t.y=i.y}this._body[0].x+=this.direction.x,this._body[0].y+=this.direction.y,this.dispatchEvent(new CustomEvent("Step",{detail:this._body})),this.draw()}changeDirection(e){let t=this._body[0],i=this._body[1];if(t.x+e.x==i.x||t.y+e.y==i.y)return;let s={oldDirection:this.direction,newDirection:e};this.direction=e,this.dispatchEvent(new CustomEvent("ChangeDirection",{detail:s}))}draw(){super.draw();for(let e=this._body.length-1;e>=0;e--){let t=this._body[e].div;0==e?(t.style.backgroundImage="url(../images/snakeHead.png)",t.style.zIndex=1):(t.style.backgroundImage="url(../images/snakeBody.png)",t.style.zIndex=0),t.style.backgroundPosition="center",t.style.backgroundSize="cover"}}onCollision(e,t){if(t instanceof a&&this===t)for(let e=1;e<this._body.length;e++)this._body[0].x==this._body[e].x&&this._body[0].y==this._body[e].y&&this.kill()}}class l extends h{constructor(e){super();let t=e.getFreeCell();t.div=null,this._body.push({x:t.x,y:t.y,div:document.createElement("div")}),this.draw()}onCollision(e,t,i){if(t instanceof a){e.score=e.score+1,t.addSegment();let s=i.getFreeCell();this._body[0].x=s.x,this._body[0].y=s.y}}draw(){super.draw();for(let e=0;e<this._body.length;e++){let t=this._body[e].div;t.style.backgroundImage="url(../images/apple.png)",t.style.backgroundPosition="center",t.style.backgroundSize="cover"}}}class o extends EventTarget{constructor(e,t,i,s,n){super(),this._segmentWidth=20,this._segmentHeight=20,this._minSegmentCountToEdge=4,this._visibleArea={x:0,y:0,minX:0,maxX:0,minY:0,maxY:0},this._visibleAreaWidth=i,this._visibleAreaHeight=s,this._viewPortDiv=n;let r=document.createElement("div");r.id="arrow-up",r.classList.add("arrow");let h=document.createElement("div");h.id="arrow-down",h.classList.add("arrow");let a=document.createElement("div");a.id="arrow-left",a.classList.add("arrow");let l=document.createElement("div");l.id="arrow-right",l.classList.add("arrow"),this._viewPortDiv.appendChild(r),this._viewPortDiv.appendChild(h),this._viewPortDiv.appendChild(a),this._viewPortDiv.appendChild(l),this._viewPortDiv.style.width=this._visibleAreaWidth,this._viewPortDiv.style.height=this._visibleAreaHeight,this._viewPortDiv.style.overflow="hidden",this._arrows={up:document.getElementById("arrow-up"),down:document.getElementById("arrow-down"),left:document.getElementById("arrow-left"),right:document.getElementById("arrow-right")},this._fieldDiv=document.createElement("div"),this._fieldDiv.style.position="relative",this._fieldDiv.style.border="1px solid rgb(0, 224, 0)",this._fieldDiv.style.boxShadow="0 0 10px rgb(0, 224, 0)",this._fieldDiv.style.webkitBoxShadow="0 0 10px rgb(0, 224, 0)",this._fieldDiv.style["-webkit-transition"]="all 0.3s ease-out",this._viewPortDiv.append(this._fieldDiv),this._fieldDiv.style.width=e*this._segmentWidth,this._fieldDiv.style.height=t*this._segmentHeight,this.setupViewPortPosition()}addSegment(e){let t=e.detail;for(let e=0;e<t.length;e++){let i=t[e];if(null==i.div){let e=document.createElement("div");e.style.position="absolute",e.style.width=this._segmentWidth,e.style.height=this._segmentHeight,e.style.left=i.x*this._segmentWidth,e.style.top=i.y*this._segmentHeight,e.style.transformOrigin="center center",this._fieldDiv.append(e),i.div=e}}}refresh(e,t=!1){t&&this._clean();for(let t=0;t<e.length;t++){let i=e[t],s=i.div;s.style.position="absolute",s.style.width=this._segmentWidth,s.style.height=this._segmentHeight,s.style.left=i.x*this._segmentWidth,s.style.top=i.y*this._segmentHeight,s.style.transformOrigin="center center",this._fieldDiv.appendChild(i.div)}}_clean(){let e=this._fieldDiv.childNodes;for(let t=0;t<e.length;t++)this._fieldDiv.removeChild(e[t])}showArrows(){this._fieldDiv.clientWidth+Number(this._fieldDiv.style.left.replace("px",""))>this._viewPortDiv.clientWidth?this._arrows.right.style.opacity=.5:this._arrows.right.style.opacity=0,Number(this._fieldDiv.style.left.replace("px",""))<0?this._arrows.left.style.opacity=.5:this._arrows.left.style.opacity=0,this._fieldDiv.clientHeight+Number(this._fieldDiv.style.top.replace("px",""))>this._viewPortDiv.clientHeight?this._arrows.down.style.opacity=.5:this._arrows.down.style.opacity=0,Number(this._fieldDiv.style.top.replace("px",""))<0?this._arrows.up.style.opacity=.5:this._arrows.up.style.opacity=0}setupViewPortPosition(){this.moveViewPort(0,0)}moveViewPort(e,t){this.resetVisibleArea(e,t),this._fieldDiv.style.left=-e*this._segmentWidth,this._fieldDiv.style.top=-t*this._segmentHeight,this.showArrows()}resetVisibleArea(e,t){this._visibleArea.x=e,this._visibleArea.y=t,this._visibleArea.minX=this._visibleArea.x+4,this._visibleArea.maxX=this._visibleArea.x+(this._visibleAreaWidth/this._segmentWidth-1)-4,this._visibleArea.minY=this._visibleArea.y+4,this._visibleArea.maxY=this._visibleArea.y+(this._visibleAreaHeight/this._segmentHeight-1)-4,this.dispatchEvent(new Event("ChangeVisibleArea"))}needViewPortRemoving(e){let t=this._visibleArea.minX,i=this._visibleArea.maxX,s=this._visibleArea.minY,n=this._visibleArea.maxY;return e.x<t||e.x>i||e.y<s||e.y>n}moveViewPortOnStep(e){let t=e.detail[0];if(this.needViewPortRemoving(t)){let e=t.x,i=t.y,s=this._visibleArea.minX,n=this._visibleArea.minY,r=this._visibleArea.maxX,h=this._visibleArea.maxY,a=this._minSegmentCountToEdge,l=this._visibleAreaWidth/this._segmentWidth,o=this._visibleAreaHeight/this._segmentHeight,c=this._visibleArea.x,d=this._visibleArea.y;c=e>r?e+a-(l-1):c,c=e<s?e-a:c,d=i>h?i+a-(o-1):d,d=i<n?i-a:d,this.moveViewPort(c,d)}}}class c{constructor(e,t){this._field=function(e,t,i){let s=new Array(t);for(let n=0;n<t;n++){let t=new Array(e);for(let s=0;s<e;s++)t[s]=i;s[n]=t}return s}(e,t,!0),this._freeCells=new Array}get columnsCount(){return this._field[0].length}get rowsCount(){return this._field.length}"take小ell"(e){this._field[e.y][e.x]=!1,this._searchFreeCell()}isFreeCell(e){return this._field[e.y][e.x]}getFreeCell(){return this._freeCells[class{static random(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}}.random(0,this._freeCells.length-1)]}refresh(e,t=!1){t&&this._clean();for(let t=0;t<e.length;t++){let i=e[t];this._field[i.y][i.x]=!1}this._searchFreeCell()}_clean(){for(let e=0;e<this._field.length;e++)for(let t=0;t<this._field[e].length;t++)this._field[e][t]=!0;this._freeCells=new Array}_searchFreeCell(){this._freeCells=new Array;for(let e=0;e<this.rowsCount;e++)for(let t=0;t<this.columnsCount;t++)this._field[e][t]&&this._freeCells.push({x:t,y:e})}}class d extends r{constructor(e,t,i){super("single-player",i),this._screen.id="game-field",this._mainCycleIntervalIDID=-1,this._gameField=new c(e,t),this._renderer=new o(e,t,i.clientWidth,i.clientHeight,this._screen),this._player=new a(this._gameField),this.maxY=t-1,this.maxX=e-1,this._score=0,this._actors=new Array,this._actors.push(this._player),this._player.addEventListener("GrowUp",this.PlayerOnGrowUp.bind(this)),this._player.addEventListener("Step",this.goThroughWalls.bind(this)),this._player.addEventListener("Step",this._renderer.moveViewPortOnStep.bind(this._renderer)),this._player.addEventListener("Death",this.stop.bind(this)),this._actors.push(new l(this._gameField))}PlayerOnGrowUp(e){let t=e.detail;this._gameField.refresh(t)}reset(){this._gameField.refresh([],!0),this._renderer.refresh([],!0),this._player=new a(this._gameField),this._score=0,this._actors=new Array,this._actors.push(this._player),this._player.addEventListener("GrowUp",this.PlayerOnGrowUp.bind(this)),this._player.addEventListener("Step",this.goThroughWalls.bind(this)),this._player.addEventListener("Step",this._renderer.moveViewPortOnStep.bind(this._renderer)),this._player.addEventListener("Death",this.stop.bind(this)),this._actors.push(new l(this._gameField)),super.reset()}stop(){this.stopMainCycle(),super.stop()}start(){-1==this._mainCycleIntervalIDID&&this.startMainCycle(),super.start()}startMainCycle(){this._mainCycleIntervalIDID=setInterval(this.mainCycleIteration.bind(this),200)}mainCycleIteration(){if(1==this._state){this._player.makeStep(),this.collisionControl(),this._actors.forEach(e=>{e.draw()});let e=this._actors.map(e=>e.body).flat();this._gameField.refresh(e,!0),this._renderer.refresh(e,!0)}}stopMainCycle(){clearInterval(this._mainCycleIntervalID)}pause(){super.pause()}onKeyboardEvent(e){switch(super.onKeyboardEvent(e),e.detail.key){case"Left":this._actors[0].changeDirection({x:-1,y:0});break;case"Right":this._actors[0].changeDirection({x:1,y:0});break;case"Up":this._actors[0].changeDirection({x:0,y:-1});break;case"Down":this._actors[0].changeDirection({x:0,y:1});break;case"Num1":this._actors[0].addSegment();break;case"Escape":this.pause()}}set score(e){this._score=e}get score(){return this._score}goThroughWalls(e){let t=e.detail;for(let e=0;e<t.length;e++){let i=t[e];i.x<0&&(i.x=this._gameField.columnsCount-1),i.x>=this._gameField.columnsCount&&(i.x=0),i.y<0&&(i.y=this._gameField.rowsCount-1),i.y>=this._gameField.rowsCount&&(i.y=0)}}collisionControl(){for(let t=0;t<this._actors.length;t++)for(let i=t;i<this._actors.length;i++){let s=this._actors[t],n=this._actors[i];function e(e,t){for(let i=0;i<e.length;i++)for(let e=0;e<t.length;e++)if(s.body[i].x==n.body[e].x&&s.body[i].y==n.body[e].y)return!0;return!1}e(s.body,n.body)&&(s.onCollision(this,n,this._gameField),n.onCollision(this,s,this._gameField))}}}class _ extends EventTarget{constructor(){super(),document.onkeydown=this.keyPress.bind(this)}keyPress(e){let t={};switch(e.code){case"ArrowUp":case"KeyW":t.key="Up";break;case"ArrowDown":case"KeyS":t.key="Down";break;case"ArrowLeft":case"KeyA":t.key="Left";break;case"ArrowRight":case"KeyD":t.key="Right";break;case"Digit1":t.key="Num1";break;case"Digit2":t.key="Num2";break;case"Digit3":t.key="Num3";break;case"Digit4":t.key="Num4";break;case"Digit5":t.key="Num5";break;case"Digit6":t.key="Num6";break;case"Digit7":t.key="Num7";break;case"Digit8":t.key="Num8";break;case"Digit9":t.key="Num9";break;case"Digit0":t.key="Num0";break;case"Escape":t.key="Escape";break;case"Enter":t.key="Enter"}null!=t.key&&this.dispatchEvent(new CustomEvent("Keyboard",{detail:t}))}}class u extends r{constructor(e,t,i){super("menu-"+e,t),this._choices=i;let s=t.clientWidth,n=t.clientHeight;this._screen.style.position="absolute",this._screen.style.width=s,this._screen.style.height=n,this._screen.style.border="3px solid rgb(255, 255, 255)",this._screen.style.boxShadow="0 0 3px rgb(255, 255, 255)",this._screen.innerHTML=`<div class="content" style="text-align: center">\n                                    <div class="title" style="margin:0 0 20 0; font-size: 20px">MENU</div>\n                                    <div class="subtitle" style="margin:10 0 10 0; font-size: 17px">This is menu</div>\n                                    ${i.map((function(e){return`<div class="${e.name} choice" style="padding: 5 0 5 0; font-size: 14px">${e.title}</div>`})).join("")}\n                                </div>`;let r=this._screen.getElementsByClassName("content")[0];r.style.marginTop=.5*(this._screen.clientHeight-r.clientHeight),r.style.width=.5*this._screen.clientWidth,r.style.marginLeft=(this._screen.clientWidth-r.clientWidth)/2,this.choice=this._choices[0].name}onKeyboardEvent(e){switch(super.onKeyboardEvent(e),e.detail.key){case"Up":this.changeChoice("Up");break;case"Down":this.changeChoice("Down");break;case"Enter":this.stop()}}set choice(e){Array.from(this._screen.getElementsByClassName("choice")).forEach((function(e){e.style.color="white",e.style.backgroundColor="black"})),this._screen.getElementsByClassName(e)[0].style.color="black",this._screen.getElementsByClassName(e)[0].style.backgroundColor="white",this._selectedChoiceName=e}set title(e){this._screen.getElementsByClassName("title")[0].innerHTML=e}set subtitle(e){this._screen.getElementsByClassName("subtitle")[0].innerHTML=e}get choice(){return this._selectedChoiceName}reset(){super.reset(),this.choice=this._choices[0].name}changeChoice(e){let t=this._choices.findIndex((function(e){return e.name==this}),this._selectedChoiceName);"Up"==e?this.choice=0==t?this._choices[this._choices.length-1].name:this._choices[t-1].name:t==this._choices.length-1?this.choice=this._choices[0].name:this.choice=this._choices[t+1].name}}class g extends EventTarget{constructor(e,t){if(super(),null==document.getElementById("game")){let e=document.createElement("div");e.id="game";let t=this.getDisplaySize(480,640);e.style.width=t.width,e.style.height=t.height,e.style.backgroundColor="black",document.body.appendChild(e)}this._div=document.getElementById("game"),this._div.style.marginTop=(document.body.clientHeight-this._div.clientHeight)/2,this._div.style.marginLeft=(document.body.clientWidth-this._div.clientWidth)/2,this._controls=new _,this._controls.addEventListener("Keyboard",this.onKeyboardEvent.bind(this)),this._currentScene=void 0;this._scenes={StartScreen:new u("start-screen",this._div,Array.from([{name:"singleplayer",title:"Single player"}])),SinglePlayer:new d(e,t,this._div),GameOverScreen:new u("game-over",this._div,Array.from([{name:"retry",title:"Retry"},{name:"quit",title:"Quit"}])),PauseScreen:new u("pause",this._div,Array.from([{name:"restart",title:"Restart"},{name:"continue",title:"Continue"},{name:"quit",title:"Quit"}]))},this._scenes.StartScreen.title="Pr. SNAKE",this._scenes.StartScreen.subtitle="",this._scenes.GameOverScreen.title="GAME OVER",this._scenes.PauseScreen.title="PAUSE",this._scenes.PauseScreen.subtitle="",this.changeCurrentScene(this._scenes.StartScreen)}getDisplaySize(e,t){let i=document.documentElement.clientWidth,s=document.documentElement.clientHeight,n=1;return n=i/s>1?s>t?1:s/t:i>e?1:i/e,{width:e*n,height:t*n}}onKeyboardEvent(e){this._currentScene.onKeyboardEvent(e)}changeCurrentScene(e){null!=this._currentScene&&(this._currentScene.removeEventListener("StateChanging",this.onSceneStateChanging.bind(this)),this._currentScene.removeEventListener("OnStop",this.onSceneStop.bind(this)),this._currentScene.removeEventListener("OnStart",this.onSceneStart.bind(this)),this._currentScene.removeEventListener("OnPause",this.onScenePause.bind(this))),this._currentScene=e,this._currentScene.start(),this._currentScene.addEventListener("StateChanging",this.onSceneStateChanging.bind(this)),this._currentScene.addEventListener("OnStop",this.onSceneStop.bind(this)),this._currentScene.addEventListener("OnStart",this.onSceneStart.bind(this)),this._currentScene.addEventListener("OnPause",this.onScenePause.bind(this))}onSceneStateChanging(e){}onSceneStop(e){let t=e.target,i=t.id;if(i==this._scenes.SinglePlayer.id){let e=t.score;this._scenes.GameOverScreen.reset(),this._scenes.GameOverScreen.subtitle="Score: "+e,this.changeCurrentScene(this._scenes.GameOverScreen)}i==this._scenes.GameOverScreen.id&&("retry"==t.choice&&(this._scenes.SinglePlayer.reset(),this.changeCurrentScene(this._scenes.SinglePlayer)),"quit"==t.choice&&(this._scenes.StartScreen.reset(),this.changeCurrentScene(this._scenes.StartScreen))),i==this._scenes.StartScreen.id&&("singleplayer"==t.choice&&(this._scenes.SinglePlayer.reset(),this.changeCurrentScene(this._scenes.SinglePlayer)),"settings"==t.choice&&(this._scenes.StartScreen.reset(),this.changeCurrentScene(this._scenes.StartScreen))),i==this._scenes.PauseScreen.id&&("continue"==t.choice&&this.changeCurrentScene(this._scenes.SinglePlayer),"restart"==t.choice&&(this._scenes.SinglePlayer.reset(),this.changeCurrentScene(this._scenes.SinglePlayer)),"quit"==t.choice&&(this._scenes.StartScreen.reset(),this.changeCurrentScene(this._scenes.StartScreen)))}onSceneStart(e){}onScenePause(e){e.target.id==this._scenes.SinglePlayer.id&&this.changeCurrentScene(this._scenes.PauseScreen)}}window.onload=function(e){new g(30,40)}}]);